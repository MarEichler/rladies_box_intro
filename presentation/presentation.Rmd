---
title: "Introduction to `{box}` Package"
author: "Martha Eichlersmith"
date: "R-Ladies Twin Cities (March 10, 2022)"
output: 
  slidy_presentation:
    duration: 20
    footer: M. Y. Eichlersmith | March 10th 2022 | R Ladies Twin Cities
    css: styles.css

---

# Goal of this talk

Introduce the `{box}` package and show how it can be used to write modularized/organized code and manage the name space.  

**Disclaimer:** I have been using this package for about 6 months and I'm still learning new things everyday!  Please ask as many questions as you want, but I may not know the answer.  

### Packages Used in the Making of this Presentation

- [`{box}`](https://klmr.me/box/)
- [`{glue}`](https://glue.tidyverse.org/): used to combine strings and R code (similar to `paste/paste0`)
- [`{tidyverse}`](https://www.tidyverse.org/) specifically `{ggplot2}`, `{dplyr}`, `{stringr}`, and `{tidyr}`


# `{box}` 

<div id="column1" style="float:left; width:15%;">
  <img style = "width: 100%; margin-top: -20px;" src="img/box-logo.png" alt="box package logo">  
</div>
<div id="column2" style="float:left; width:60%;">
  <ul>
    <li><a href = "https://klmr.me/box/" target = "_blank"><code>{box}</code></a> is a relatively new package</li>
    <li>first version released on GitHub in July 2017</li>
    <li>first version on CRAN in February 2021</li>
    <li>Current version <a href="https://cloud.r-project.org/web/packages/box/index.html" target = "_blank">1.1.0</a> released in September 2021
  </ul>
</div>



# Why use `{box}`? 

- Clean-up/Manage name space 
- Modular-ize code without having to write full package 
  * purposeful and organized code 
  * if change code within box module, importation of box module doesn't change 

Box modules are like mini-packages: help re-use or share code without the much larger hurdle of developing a whole R package 

- re-use code for yourself if doing similar actions frequently 
- share code internally with peers/colleague (create consistency)
- share externally


# Why use `{box}`: Name Space

<div id = "contentbox", style = "width: 100%; display: block; margin-left: auto; margin-right: auto;">
  <div id="column1" style="float:left; width:40%;">
    Name space: group of items (data frames, functions, vectors, lists, etc.) that each have a unique name. <br>
    <img style = "width: 100%; padding-top:10px;" src="img/tv_conflicts.PNG" alt="Loading Tidyverse">  
    <ul>
      <li><code>{dplyr}</code> and <code>{stats}</code> use the same name for certain functions, CONFLICT in the namespace</li>
      <li>If want to use the </code>{stats}</code> function, have to refer to the package: </code>stats::filter()</code></li>
    </ul>
  </div>
  <div id="column2" style="float:right; width:58%;">
    <center><b>R Environment: Global Environment</b></center>
    <img style = "width: 100%; padding-top:10px;" src="img/environment1.PNG" alt="New R Session">  
    <img style = "width: 100%; padding-top:10px;" src="img/environment2.PNG" alt="Adding to Namespace">
  </div>
</div>

# Why use `{box}`: Modular-ize 

- put code in to 'modules' or sections
- can have each module for a specific situation or group of functions
- other coding languages used in data science have this capability as well 
  * C++ with namespace 
  * Python with modules/packages
  * JavaScript with node modules 

# Quick Example: Different Ways of Coding 

- data set with both character and numeric variables 
- two types of plots  
- want to create 2 of each type of plot using different variables 

<small>*Note:* this is a simplified version of the example in the `DIR_ROOT` folder of the repository, using `mpg` data from the `{ggplot2}`</small>  

<div id = "contentbox", style = "width: 90%; display: block; margin-left: auto; margin-right: auto;">
  <div id="column1" style="float:left; width:49%;">
    <center><b>A: Frequency Bar Plot</b><br>Character or Discrete Numeric Variables</center>
    <img class = "myimg" style = "width: 80%;" src="img/A_plot_table.png" alt="Goal A: Table Plot">  
  </div>
  <div id="column2" style="float:right; width:49%;">
    <center><b>B: Slope Plot</b><br>Mean of Continuous Numeric Variable at Two Points</center>
    <img class = "myimg" style = "width: 80%;" src="img/B_plot_slope.png" alt="Goal B: Slope Plot">  
  </div>
</div>
<br> 



# Option 1: Write Out Code 

<img class="myimg" width="70%" src="img/opt1.PNG" alt="Option 1 - Write Out all Code for each plot"> 

Create plots with different variables &#8658; more code (write or copy/paste)

More situations/dimensions &#8658; additional unstructured code: 

- more mess and less organization 
- more name space usage 
- bad practice to continue to repeat code  

# Option 2: Multiple Functions 

<img class="myimg" width="70%" src="img/opt2.PNG" alt="Option 2 - Multiple functions"> 

Create plots with different variables &#8658; can easily use functions

More situations/dimensions &#8658; more functions: 

- more name space usage  
- difficult to maintain and keep consistency (i.e. formatting across plots) 



# Option 3: One Long Function 

<img class="myimg" width="70%" src="img/opt3.PNG" alt="Option 3 - one long functions"> 

Create plots with different variables &#8658; can easily use function 

More situations/dimensions &#8658; Longer function

- difficult to maintain because of large size 
- difficult to test (one part of the function breaks, entire function won't work) 


# Option 4: &#127775; Box Modules &#127775;


<img class="myimg" width = "85%" src="img/opt4.PNG" alt="Option 4 - box modules"> 

<div id = "contentbox", style = "width: 100%; display: block; margin-left: auto; margin-right: auto;">
  <div id="column1" style="float:left; width:40%;">
    <ul>
      <li>Only box modules are in the name space</li>
      <li>Can use any <b>exported</b> functions 
      <li>Refer to other box modules within a specific modules</li>
    </ul>
    Create plots with different variables &#8658; use functions from modules 
  </div>
  <div id="column2" style="float:right; width:58%;">
    More situations/dimensions &#8658; add/amend box modules
    <ul>
      <li>Test within a specific box module</li>
      <li>Break up long functions into multiple functions but only export the final function</li>
      <li>Much smaller usage of name space</li>
      <li>Easier to share with internally/externally </li>
    </ul>
  </div>
</div>


# Comparison  

<table class = "mytable">
  <tr>
    <th style="width:12%">Item</th>
    <th style="width:22%">Option 1<br>Write Out Code</th>
    <th style="width:22%">Option 2<br>Multiple Functions</th>
    <th style="width:22%">Option 3<br>One Long Function</th>
    <th style="width:22%">Option 4<br>Box Modules</th>
  </tr>
  <tr>
    <td class = "fst">Namespace Usage</td>
    <td> 
      <img class="myemoji" src="img/red_frown.svg" alt="Red Frown"><br>
      Constantly have to create unique names for objects
    </td>
    <td> 
      <img class="myemoji" src="img/yellow_meh.svg" alt="Yellow Meh"><br>
      Only use name space for specific functions and/or dependencies 
    </td>
    <td> 
      <img class="myemoji" src="img/green_smile.svg" alt="Green Smile"><br>
      Only use name space for specific function 
    </td>
    <td> 
      <img class="myemoji" src="img/green_smile.svg" alt="Green Smile"><br>
      Only use name space for box modules 
    </td>
  </tr>
  <tr>
    <td class = "fst">Testing Code</td>
    <td> 
      <img class="myemoji" src="img/yellow_meh.svg" alt="Yellow Meh"><br>
      Testing code as written but shouldnâ€™t repeat code multiple times 
    </td>
    <td> 
      <img class="myemoji" src="img/green_smile.svg" alt="Green Smile"><br>
      Functions are sectioned so can test at each level 
    </td>
    <td> 
      <img class="myemoji" src="img/red_frown.svg" alt="Red Frown"><br>
      Difficult to test individual sections once function get extremely long 
    </td>
    <td> 
      <img class="myemoji" src="img/green_smile.svg" alt="Green Smile"><br>
      All testing can be done within the module 
    </td>
  </tr>
  <tr>
    <td class = "fst">Share/Re-Use</td>
    <td> 
      <img class="myemoji" src="img/red_frown.svg" alt="Red Frown"><br>
      Have to piece through which code to keep and then amend to new program
    </td>
    <td> 
      <img class="myemoji" src="img/red_frown.svg" alt="Red Frown"><br>
      Put functions together and document dependencies 
    </td>
    <td> 
      <img class="myemoji" src="img/yellow_meh.svg" alt="Yellow Meh"><br>
      One function but may be challenging to amend to a different situation or different machine
    </td>
    <td> 
      <img class="myemoji" src="img/green_smile.svg" alt="Green Smile"><br>
      Just send the box modules <code>.R</code> files 
    </td>
  </tr>
  <tr>
    <td class = "fst">Additional Dimensions</td>
    <td>
      <img class="myemoji" src="img/red_frown.svg" alt="Red Frown"><br>
      New code either added to existing code or new section, bad practice if will use multiple times 
    </td>
    <td>
      <img class="myemoji" src="img/red_frown.svg" alt="Red Frown"><br>
      Manageable to difficult depending on how much each of the functions and their dependencies need to change 
    </td>
    <td>
      <img class="myemoji" src="img/red_frown.svg" alt="Red Frown"><br>
      Difficult given that the function is so large, adding a new dimension would be challenging 
    </td>
    <td>
      <img class="myemoji" src="img/green_smile.svg" alt="Green Smile"><br>
      Adjust easily within the box module or create a new box module (depending on situation) 
    </td>
  </tr>

</table>


# 

<br><br><br><br><br><br>
<center style="font-size: 2.5em; font-weight: bold;">Let's Learn how to use <code>{box}</code><center>

# Box: File/Folder Structure 

- Box modules are simply `.R` files with specific instructions
- Best to put all modules into a folder to keep organized 
- Folder can be named anything (I often see 'box' or 'modules')

Example folder structure: 

<div style="font-family: Ubuntu Mono; font-size: 0.90em; background-color: var(--liteblue); width: 60%;">
DIR_ROOT  
|  
|---myboxes <i>#folder can have any name</i>   
|   |  
|   |---Abox.R   
|   |---Bbox.R  
|   
|---my.Rmd  <i>#main RMD file that will generate report/html</i>  
</div>

- how you call box modules will depend on the structure of folders 
- similar to including images or sourcing (`source(file.R)`)


# Box: External Packages

- when starting your box module will need to use package (e.g. `{ggplot2}`, `{dplyr}`, etc.)
- Usually load packages using `library()` command 
- Need to load packages and functions with `box::use()`, NOT `library()`

<div class = "quote">
`box::use` is a **universal import declaration**. It works for packages just as well as for modules. In fact, â€˜boxâ€™ completely replaces the base R `library` and `require` functions. `box::use` is more explicit, more flexible, and less error-prone than `library`. At its simplest, it provides a direct replacement
</div>
<div class = "quotesource"><a href = "https://klmr.me/box/#loading-code" target = "_blank" style = "color: black !important;">- klmr.me/box/#loading-code</a></div>


# Box: `box::use()` 

### To Use Box Module 

`box::use( myboxes/Abox)` 

- `myboxes`: folder where box module file is located 
- `Abox`: name of box module to load (*without* the `.R` extension)


### To Use Packages 

<div id = "contentbox2", style = "width: 100%;">
  <div id="column1" style="float:left; width:49%;">
    <center style = "background-color: var(--liteblue);">
      <code>box::use(</code>
      <code><b>dplyr[...]</b></code>
      <code>)</code></b></center><br>
    <ul>
      <li>Imports <code>{dplyr}</code> and attached all exported names</li>
      <li>Similar to <code>library(dplyr)</code></li>
      <li>Use any <code>{dplyr}</code> functions without specifying the package name</li>
      <li>If just use <code>box::use(dplyr)</code>, would not be able to use functions without calling package (i.e. <code>dplyr::filter</code>)
    </ul>
  </div>
  <div id="column2" style="float:right; width:49%;">
    <center style = "background-color: var(--liteblue);">
      <code>box::use(</code>
      <code><b>dplyr[filter, select]</b></code>
      <code>)</code></b></center><br>
    <ul>
      <li>Imports  <code>{dplyr}</code> and attaches the names <code>dplyr::filter</code> and <code>dplyr::select</code></li>
      <li>Use <code>filter()</code> and <code>select()</code> from <code>{dplyr}</code></li>
      <li>Would <b>not</b> be able to use <code>mutate()</code></li>
      <li>Could use <code>dplyr::mutate()</code></li>
    </ul>
  </div>
</div>




# Box: Write Your Functions/Code (boring text info)   

- can use anything in the box modules as dependencies for functions 
- only need to export the final functions you want to use outside of the module 
   * in order to export need to use `#' @export` 
- Use [Roxygen](https://cran.r-project.org/web/packages/roxygen2/vignettes/roxygen2.html): 
   * `#'` before each line with information on function 
   * `@param` details out the variable inputs (each input has own line) 
   * `@return` details what function returns 
   * `@export` export item, to use outside module [REQUIRED if want to use outside of module]
   * `@example` examples of using function 
   * can include as many or as few as you want (best practice to include all but I often don't, c'est la vie)
- Shortcut to Insert Roxygen Skeleton (need to have cursor within a function): 
  * Windows/Linux: Ctrl+Shift+Alt+R
  * Mac: Option+Shift+Command+R
  * Roxygen is a way to document code, it's used in the development of R packages
  
**Roxygen Skeleton**
  
```{r, eval = FALSE}
#' Title
#'
#' @param 
#'
#' @return
#' @export
#'
#' @examples

```


# Box: Write Your Functions/Code 

<div id="column1" class = "mycolumn"> 

  <div class = "colheader">Write Code</div>
  
  <div style="height: 2em;">
  example: `box/test.R` file 
  </div>
  
  <div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>box<span class="sc">::</span><span class="fu">use</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    glue[glue]</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  , stringr[str_to_lower, str_to_title]</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; not exported, used WITHIN only </span></span>
<span id="cb1-7"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>greeting <span class="ot">&lt;-</span> <span class="st">&quot;Hello&quot;</span> </span>
<span id="cb1-8"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Greet Someone when Given a Name  </span></span>
<span id="cb1-10"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span><span class = "cf">@param </span><span class="var">name </span><span class="co">A character string </span></span>
<span id="cb1-11"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span><span class = "cf">@return </span><span class="co">Greeting with input name  </span></span>
<span id="cb1-12"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span><span class = "cf">@export </span></span>
<span id="cb1-13"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span><span class = "cf">@examples </span></span>
<span id="cb1-14"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; say_hello(&quot;Martha&quot;)</span></span>
<span id="cb1-15"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>say_hello <span class="ot">&lt;-</span> <span class="cf">function</span>(name){</span>
<span id="cb1-16"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  to_use <span class="ot">&lt;-</span> <span class="fu">str_to_title</span>(<span class="fu">str_to_lower</span>(name))</span>
<span id="cb1-17"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glue</span>(<span class="st">&quot;{greeting}, {to_use}&quot;</span>)</span>
<span id="cb1-18"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>

</div>
<div id="column2" class = "mycolumn"> 

   <div class = "colheader">Import Module</div>
  
  <div style="height: 2em;">
  Pathway to module file, do not include `.R` extension 
  </div>
  
  <div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>box<span class="sc">::</span><span class="fu">use</span>(</span>
  <span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  box<span class="sc">/</span>test </span>
  <span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>

  
</div>
<div id="column3" class = "mycolumn"> 

  <div class = "colheader">Use Module!</div>
  
  <div style="height: 2em;">
  Use `$` to use exported functions (similar to `::` for packages)
  </div>
  
  <div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span><span class="fu">say_hello</span>(<span class="st">&quot;Martha&quot;</span>)</span></code></pre></div>
  <pre><code>## Hello, Martha</code></pre></div>

</div>




